<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>博客來-會員登入</title>
<meta name="keywords" content="博客來,會員登入">
<meta name="description" content="博客來-會員登入">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<!-- <link rel="stylesheet" href="/css/css.css"> -->
<link rel="stylesheet" href="https://jci.book.com.tw/css/books/newmember/css.css">

<script type="text/javascript" src="https://jci.book.com.tw/jss/jquery/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="https://jci.book.com.tw/jss/books/jqueryplugin/purl.js" ></script>
<script type="text/javascript" src="/js/jquery.placeholder.js" ></script>
<script type="text/javascript" src="/js/common.js?v=20201001" ></script>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-TBZGS7');</script>
<script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script>
<script type="text/javascript">
$(function(){
    var c = false;
    $('input, textarea').placeholder();
    $('#login_id').focus();
    $('.banner_btn').mouseover(function(e){ //banner
        var id = 'banner_' + $(this).attr('id');
        $('.banner_btn').removeClass('here');
        $(this).addClass('here');
        $('.banli').hide();
        $('#'+id).fadeIn();
    }).eq($('#bannerStart').val()).mouseover();
    $('#regen').click(function(e){   //更新驗證碼
        e.preventDefault();
        $.ajax({
            url: "/member/regen_captcha",
            success: function(data, textStatus){
                var imgUrl = "/member/captcha_login?" + data;
                $('#captcha_img').empty().html('<img src="' + imgUrl + '" width="160" height="75" />');
                $('#captcha').val('');
            },
            error: function(jqXHR, textStatus) {
                if (jqXHR.status === 408) {
                    alert('您的操作有誤，請再重新操作');
                } else {
                    alert('系統忙碌中，請稍後再試');
                }
            }
        })
    });
    $('#captcha').keypress(function(e){  //captcha
        $('#captcha_warn').html('').hide();
        if (e.which == 13){
            e.preventDefault();
            $('#books_login').click();
        }
    });
    $('#login_id').keypress(function(e){    //login id
        $('#id_warn').html('').hide();
        if (e.which == 13){
            e.preventDefault();
            $('#books_login').click();
        }
    });
    $('#login_pswd').keypress(function(e){  //login pswd
        $('#pswd_warn').html('').hide();
        var s = String.fromCharCode(e.which);
        if ((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)||
                (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) { //caps is on
            $("#caps_warn").show();
        }else if ((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
                (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) { //caps is off
            $("#caps_warn").hide();
        }
        if (e.which == 13){
            e.preventDefault();
            $('#books_login').click();
        }
    });
    $('#books_login').click(function(e){    //login
        e.preventDefault();
        var loginId = $.trim($('#login_id').val());
        if (loginId == ''){    //驗證 login id
            $('#id_warn').html('請輸入帳號ID或email').show();
            return;
        }
        var loginPswd = $.trim($('#login_pswd').val());
        if (loginPswd == ''){    //驗證 login pswd
            $('#pswd_warn').html('請輸入密碼 Password').show();
            return;
        }
        var captcha = $.trim($('#captcha').val());
        if (captcha == ''){    //驗證 login pswd
            $('#captcha_warn').html('請輸入驗證碼').show();
            return;
        }
        maskDivShow();
        $.ajax({
            url: "/member/login_do/",
            data: {
                captcha: captcha,
                login_id: loginId,
                login_pswd: loginPswd

            },
            type: 'POST',
            success: function(data, textStatus){
                var result = $.parseJSON(data);
                if (result.success){    //登入成功
                    if (result.code == 168){
                        location.href = "https://cart.books.com.tw/member/login_2factors/B/?url=https%3A%2F%2Fwww.books.com.tw%2F&content=";
                    } else {
                        if (result.code != 1){
                            $('#url').val("https://cart.books.com.tw/member/email_no_auth/");
                        }
                        go();
                    }
                }else{  //登入失敗
                    maskDivHidden();
                    if (result.code == 1){  //驗證碼錯誤
                        $('#captcha').val('');
                        $('#regen').click();
                        $('#captcha_warn').html(result.msg).show();
                    } else if (result.code == 2){   //帳號密碼錯誤
                        $('#login_pswd').val('');
                        $('#captcha').val('');
                        $('#regen').click();
                        openPopDiv('wdialog');
                    } else if (result.code == 3){  //帳號密碼錯誤
                        c = true;
                        openPopDiv('wdialog');
                    } else if (result.code == 4){ //異常會員需修改密碼
                        $('#pswd_safety_text').html('<li>由於您已有一段時間未異動密碼，為維護個人帳戶的安全性，</li><li>需請您變更密碼，謝謝您的配合</li>');
                        $('#keep_password').hide();
                        $('#update_password2').hide();
                        $('#update_password1').show();
                        openPopDiv('pswd_safety');
                    } else if (result.code == 5){ //密碼最後異動日超過6個月
                        $('#pswd_safety_text').html('<li>您已超過六個月未異動密碼，建議您變更密碼，以維謢個人帳戶安全性!!</li>');
                        $('#update_password1').hide();
                        $('#update_password2').show();
                        $('#keep_password').show();
                        openPopDiv('pswd_safety');
                    } else if (result.code == 168){ //兩階段驗證登入
                        alert('系統忙碌中，請稍後再試');
                        location.reload();
                    }
                }
            },
            error: function(jqXHR, textStatus) {
                if (jqXHR.status === 408) {
                    var r = $.parseJSON(jqXHR.responseText);
                    alert(r.msg ? r.msg : '您的操作有誤，請再重新操作');
                } else {
                    alert('系統忙碌中，請稍後再試');
                }
                maskDivHidden();
            }
        });
    });
    var fbwin;
    $('#facebook_login').click(function(e){  //facebook login
        e.preventDefault();
        maskDivShow();
        if (!fbwin || fbwin.closed !== false) {
            fbwin = window.open($('#fbUrl').val(), 'fb_login', 'left=500,top=200,width=500,height=300,toolbar=no,location=no,menubar=no,status=0');
        }
        fbwin.focus();
        var pollTimer = window.setInterval(function() {
            if (!fbwin || fbwin.closed !== false) { // !== is required for compatibility with Opera
                window.clearInterval(pollTimer);
                maskDivHidden();
            }
        }, 200);
    });
    $('#wdialog_close').click(function(e){   //login failed - close window
        e.preventDefault();
        if (c){
            location.reload();
        }else{
            closePopDiv('wdialog');
        }
    });
    $('#retype').click(function(e){  //login failed - retype
        e.preventDefault();
        if (c){
            location.reload();
        }else{
            closePopDiv('wdialog');
        }
    });
    $('#fbterm_close').click(function(e){   //fb使用說明 - 關閉視窗
        e.preventDefault();
        closePopDiv('fbterm');
    });
    $('#fbterm_agreen').click(function(e){   //fb使用說明 - 同意
        e.preventDefault();
        closePopDiv('fbterm');
        // clean previous value
        $('#link_id').val('');
        $('#link_pswd').val('');
        $('#link_warn').empty();
        openPopDiv('link');
    });
    $('#fbterm_disagreen').click(function(e){   //fb使用說明 - 不同意
        e.preventDefault();
        closePopDiv('fbterm');
    });
    $('#link_close').click(function(e){   //fb連結 - 關閉視窗
        e.preventDefault();
        closePopDiv('link');
    });
    $('#lineterm_close').click(function(e){   //Line使用說明 - 關閉視窗
        e.preventDefault();
        closePopDiv('lineterm');
    });
    $('#lineterm_agreen').click(function(e){   //Line使用說明 - 同意
        e.preventDefault();
        closePopDiv('lineterm');
        // clean previous value
        $('#line_link_id').val('');
        $('#line_link_pswd').val('');
        $('#line_link_warn').empty();
        openPopDiv('line_link');
    });
    $('#lineterm_disagreen').click(function(e){   //Line使用說明 - 不同意
        e.preventDefault();
        closePopDiv('lineterm');
    });
    $('#line_link_close').click(function(e){   //LINE綁定 - 關閉視窗
        e.preventDefault();
        closePopDiv('line_link');
    });

    $('#opOtp_close').click(function(e){   // OPEN POINT otp - 關閉視窗
        e.preventDefault();
        $('#otp_code').val('');
        closePopDiv('op_otp_win');
    });

    $('#opterm_close').click(function(e){   // OPEN POINT使用說明 - 關閉視窗
        e.preventDefault();
        closePopDiv('opterm');
    });

    $('#opterm_agreen').click(function(e){   //OPEN POINT使用說明 - 同意
        e.preventDefault();
        closePopDiv('opterm');
        // clean previous value
        $('#op_link_id').val('');
        $('#op_link_pswd').val('');
        $('#op_link_warn').empty();
        openPopDiv('op_link');
    });

    $('#opterm_disagreen').click(function(e){   //OPEN POINT使用說明 - 不同意
        e.preventDefault();
        closePopDiv('opterm');
    });

    $('#op_link_close').click(function(e){   //OPEN POINT 綁定 - 關閉視窗
        e.preventDefault();
        closePopDiv('op_link');
    });

    $('#link_id').keypress(function(e){ //link fb id
        $('#link_warn').html('').hide();
    });
    $('#link_pswd').keypress(function(e){  //link fb pswd
        $('#link_warn').html('').hide();
        var s = String.fromCharCode(e.which);
        if ((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)||
                (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) { //caps is on
            $("#link_warn").html('大寫鎖定 (Caps Lock) 已啟用').show();
        }else if ((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
                (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) { //caps is off
            $("#link_warn").html('').hide();
        }
    });
    $('#link_agreen').click(function(e){   //fb連結-同意
        e.preventDefault();
        var linkId = $.trim($('#link_id').val());
        var linkPswd = $.trim($('#link_pswd').val());
        if (linkId == ''){    //驗證 link fb id
            $('#link_warn').html('請輸入帳號ID或email').show();
            return;
        }
        if (linkPswd == ''){    //驗證 login pswd
            $('#link_warn').html('請輸入密碼 Password').show();
            return;
        }
        $('#link_agreen').prop('disabled', true);
        $('#link_warn').html("連結中...請稍後...").show();
        $.ajax({
            url: "/member/link_fb_do",
            data: {
                link_id: linkId,
                link_pswd: linkPswd
            },
            type: 'POST',
            success: function(data, textStatus){
                var result = $.parseJSON(data);
                if (result.success){    //連結登入成功
                    go();
                }else{  //連結登入失敗
                    $('#link_agreen').prop('disabled', false);
                    $('#link_warn').html(result.msg).show();
                }
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
                $('#link_agreen').prop('disabled', false);
                $('#link_warn').html("").show();
            }
        });
    });
    $('#link_disagreen').click(function(e){   //fb連結-不同意
        e.preventDefault();
        closePopDiv('link');
    });
    $('#line_link_disagreen').click(function(e){   //LINE綁定-不同意
        e.preventDefault();
        closePopDiv('line_link');
    });
    $('#line_link_id').keypress(function(e){ //link line id
        $('#line_link_warn').html('').hide();
    });
    $('#line_link_pswd').keypress(function(e){  //link line pswd
        $('#line_link_warn').html('').hide();
        var s = String.fromCharCode(e.which);
        if ((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)||
                (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) { //caps is on
            $("#line_link_warn").html('大寫鎖定 (Caps Lock) 已啟用').show();
        }else if ((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
                (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) { //caps is off
            $("#line_link_warn").html('').hide();
        }
    });
    /** LINE綁定 - 同意 */
    $('#line_link_agreen').click(function(e){
        e.preventDefault();
        var linkId = $.trim($('#line_link_id').val());
        var linkPswd = $.trim($('#line_link_pswd').val());
        if (linkId == ''){    //驗證 link fb id
            $('#line_link_warn').html('請輸入帳號ID或email').show();
            return;
        }
        if (linkPswd == ''){    //驗證 login pswd
            $('#line_link_warn').html('請輸入密碼 Password').show();
            return;
        }
        $('#line_link_agreen').prop('disabled', true);
        $('#line_link_warn').html("連結中...請稍後...").show();
        $.ajax({
            url: "/member/link_line_do",
            data: {
                link_id: linkId,
                link_pswd: linkPswd
            },
            type: 'POST',
            success: function(data, textStatus){
                var result = $.parseJSON(data);
                if (result.success){    //連結登入成功
                    go();
                }else{  //連結登入失敗
                    $('#line_link_agreen').prop('disabled', false);
                    $('#line_link_warn').html(result.msg).show();
                }
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
                $('#line_link_agreen').prop('disabled', false);
                $('#line_link_warn').html("").show();
            }
        });
    });
    
    $('#op_link_id').keypress(function(e){ //link OPEN PONT id
        $('#op_link_warn').html('').hide();
    });
    $('#op_link_pswd').keypress(function(e){  //link OPEN PONT pswd
        $('#op_link_warn').html('').hide();
        var s = String.fromCharCode(e.which);
        if ((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)||
                (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) { //caps is on
            $("#op_link_warn").html('大寫鎖定 (Caps Lock) 已啟用').show();
        }else if ((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
                (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) { //caps is off
            $("#op_link_warn").html('').hide();
        }
    });

    //OPEN PONT綁定-不同意
    $('#op_link_disagreen').click(function(e){
        e.preventDefault();
        closePopDiv('op_link');
    });

    /** OPEN PONT綁定 - 同意 */
    $('#op_link_agreen').click(function(e){
        e.preventDefault();
        var linkId = $.trim($('#op_link_id').val());
        var linkPswd = $.trim($('#op_link_pswd').val());
        if (linkId == ''){    //驗證 link fb id
            $('#op_link_warn').html('請輸入帳號ID或email').show();
            return;
        }
        if (linkPswd == ''){    //驗證 login pswd
            $('#op_link_warn').html('請輸入密碼 Password').show();
            return;
        }
        $('#op_link_agreen').prop('disabled', true);
        $('#op_link_warn').html("連結中...請稍後...").show();
        $.ajax({
            url: "/itgt/do_link_op",
            data: {
                link_id: linkId,
                link_pswd: linkPswd
            },
            type: 'POST',
            success: function(data, textStatus){
                var result = $.parseJSON(data);
                if (result.success){    //連結登入成功
                    go();
                }else{  //連結登入失敗
                    $('#op_link_agreen').prop('disabled', false);
                    $('#op_link_warn').html(result.msg).show();
                }
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
                $('#op_link_agreen').prop('disabled', false);
                $('#op_link_warn').html("").show();
            }
        });
    });
    $('#pswd_close').click(function(e){   //密碼安全性提示訊息 - 關閉視窗
        e.preventDefault();
        closePopDiv('pswd_safety');
    });
    $('#keep_password').click(function(e){ //密碼安全性 - 沿用舊密碼
        $('#keep_password').hide();
        $('#update_password1').hide();
        $('#update_password2').hide();
        var loginId = $.trim($('#login_id').val());
        var loginPswd = $.trim($('#login_pswd').val());
        $.ajax({
            url: "/member/keep_password",
            data: {
                login_id: loginId,
                login_pswd: loginPswd
            },
            type: 'POST',
            success: function(data, textStatus){
                var result = $.parseJSON(data);
                if (result.success){    //更新會員檔成功
                    closePopDiv('pswd_safety');
                    $('#books_login').click();//完成登入的動作
                }else{
                    alert(result.msg);
                }
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
                maskDivHidden();
            }
        });
    });
    $('#update_password1').click(function(e){ //密碼安全性 - 異常會員修改密碼
        $('#keep_password').hide();
        $('#update_password1').hide();
        $('#update_password2').hide();
        var loginId = $.trim($('#login_id').val());
        var url = $('#url').val();
        $().redirect('update_password', {'loginId': loginId,'unusual' : 'Y','back_url' :url}, 'POST');
    });
    $('#update_password2').click(function(e){ //密碼安全性 - 修改密碼
        $('#keep_password').hide();
        $('#update_password1').hide();
        $('#update_password2').hide();
        var loginId = $.trim($('#login_id').val());
        var url = $('#url').val();
        $().redirect('update_password', {'loginId': loginId,'unusual' : 'N','back_url' :url}, 'POST');
    });

    var linewin;
    $('#line_login').click(function(e){  //line login
        e.preventDefault();
        maskDivShow();
        var _h = 500;
        var _t = ($(window).height() - _h) / 2;
        if (!linewin || linewin.closed !== false) {
            linewin = window.open('/member/go_to_line_auth', 'line_login', 'left=500,top='+_t+',width=400,height='+_h+',toolbar=no,location=no,menubar=no,status=0');
        }
        linewin.focus();
        var pollTimer = window.setInterval(function() {
            if (!linewin || linewin.closed !== false) { // !== is required for compatibility with Opera
                window.clearInterval(pollTimer);
                maskDivHidden();
            }
        }, 200);
    });

    var opwin;
    $('#op_login').click(function(e){  //openpoint login
        e.preventDefault();
        maskDivShow();
        var _h = 620;
        var _t = ($(window).height() - _h) / 2;
        if (!opwin || opwin.closed !== false) {
            opwin = window.open('/itgt/go_to_op_auth', 'op_login', 'left=500,top='+_t+',width=480,height='+_h+',toolbar=no,location=no,menubar=no,status=0');
        }
        opwin.focus();
        var pollTimer = window.setInterval(function() {
            if (!opwin || opwin.closed !== false) { // !== is required for compatibility with Opera
                window.clearInterval(pollTimer);
                maskDivHidden();
            }
        }, 200);
    });

    /** OPEN POINT OTP 重新傳送 */
    $('#resend_otp_btn').click(function (e) {
        e.preventDefault();
        var $err = $('#op_otp_win .set_cont p.err');
        $err.html('');

        if (GetTimeRemaining(NextOTPEndTime) > 0 || $('#resend_otp_btn').hasClass('disabled')) {
            // $err.html('請勿在短時間內重複發送');
            return;
        }

        $.ajax({
            type:'get',
            url: "/itgt/do_resend_otp",
            dataType : 'json',
            beforeSend: function (jqXHR) {
                $('#resend_otp_btn').addClass('disabled');
            },
            success: function(res){
                if (res.success) {
                    if (res.otp_code)   $('#dev_otpCode').html(res.otp_code);
                    $('#dev_otpExpire').html(res.otp_expire);
                    OTPExpireTime = res.otp_expire;
                    OTPRemainAmt = res.otp_remain_amount;
                    NextOTPEndTime = res.otp_next_send_time;
                    if (OTPRemainAmt > 0) {
                        CountDownOTPResendTime(NextOTPEndTime);
                    }
                    CountDownOTPExpireTime(OTPExpireTime);
                    $('#tp-msg').html('驗證碼已傳至您的<font color="#d80000">OPEN POINT會員註冊時的手機號碼</font>，請於有效期限內輸入OTP驗證碼');
                    $('#resend_valid_times').html(OTPRemainAmt);
                }else{
                    /** 授權失敗，重新登入 */
                    if (res.code == 'E001') {
                        alert(res.msg);
                        $('#opOtp_close').trigger('click');
                    }
                    /** 簡訊發送已達發送上限 */
                    else if(res.code == 'E003'){
                        alert('今日手機驗證碼已達發送上限，請隔日重新操作');
                        $('#resend_otp_btn').addClass('disabled');
                    }
                    /** 簡訊發送失敗 */
                    else if(res.code == 'E004'){
                        $('#tp-msg').html('驗證碼發送失敗');
                    }
                    else{
                        if (res.msg) $err.html(res.msg);
                    }
                }
                
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
            }
        })
    });
    // ---- END op otp 重新傳送

    /** OPEN POINT OTP驗證 */
    $('#otp_verify_btn').click(function(e){
        e.preventDefault();
        var $err = $('#op_otp_win .set_cont p.err');
        var otp_code = $.trim($('#otp_code').val());
        $err.html('');

        if (otp_code == '') {
            $err.html('請輸入OTP驗證碼');
            return;
        }

        $.ajax({
            type:'post',
            url: "/itgt/do_verify_otp",
            data: {
                verify_code: otp_code
            },
            dataType : 'json',
            success: function(res){
                if (res.success) {
                    // open open point term
                    showOpTerm();
                    $('#opOtp_close').trigger('click');
                }else{
                    /** 授權失敗，導重新登入 */
                    if (res.code == 'E001') {
                        alert(res.msg);
                        $('#opOtp_close').trigger('click');
                    }else{
                        if (res.msg) $err.html(res.msg);
                    }
                }
                
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
            }
        })
    });
});
function go(){
    // content analyze
    var content = $('#content').val();
    var ctParam = {};
    if (content.length !== 0){
        var ctAry = content.split(";");
        for(var key in ctAry) {
            var ctkey = ctAry[key].split('=');
            ctParam[ctkey[0]] = ctkey[1];
        }
    }
    // url analyze
    var url = $('#url').val();
    var urlObj = $.url(url);
    var param = $.extend({}, urlObj.param(), ctParam);
    var domain = urlObj.attr('protocol') + '://' + urlObj.attr('host');
    var path = urlObj.attr('path');
    var method = 'GET';
    // post/get redirect
    if (url.indexOf('/shopping/cart.php') >= 0
            || url.indexOf('/shopping/promote_cart.php') >= 0
            || url.indexOf('/shopping/supplier_cart.php') >= 0){   //force POST
        method = 'POST';
    }
    $().redirect(domain + path, param, method);
}
function showFbTerm(){
    if ($('#fbterm_text').html() == ""){
        $.ajax({
            url: "/member/fb_login_service_term",
            success: function(data, textStatus){
                $('#fbterm_text').html(data);
                openPopDiv('fbterm');
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
            }
        })
    }else{
        openPopDiv('fbterm');
    }
}

function showLineTerm(){
    if ($('#lineterm_text').html() == ""){
        $.ajax({
            url: "/member/line_login_service_term",
            success: function(data, textStatus){
                $('#lineterm_text').html(data);
                openPopDiv('lineterm');
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
            }
        })
    }else{
        openPopDiv('lineterm');
    }
}

/** OPEN POINT 綁定說明 POPUP*/
function showOpTerm(){
    if ($('#opterm_text').html() == ""){
        $.ajax({
            url: "/itgt/login_service_term",
            success: function(data, textStatus){
                $('#opterm_text').html(data);
                openPopDiv('opterm');
            },
            error: function(jqXHR, textStatus) {
                alert('系統忙碌中，請稍後再試');
            }
        })
    }else{
        openPopDiv('opterm');
    }
}

/** 顯示OPENPONIT OTP驗證 */
function showOpOtp(mobile_country, mobile, next_send_time, otp_code, otp_expire, otp_remain_qty, err_msg) {
    // console.log(mobile_country, mobile, otp_code, otp_expire);
    $('#op_otp_win').find('.phone-number').html('+'+mobile_country+'&nbsp;'+mobile);
    if (err_msg) {
        // $('#op_otp_win').find('.err').html(err_msg);
    }
    if (otp_code) {
        $('#dev_otp').find('#dev_otpCode').html(otp_code);
        $('#dev_otp').show();
    }
    
    NextOTPEndTime = next_send_time;
    OTPExpireTime = otp_expire;
    OTPRemainAmt = otp_remain_qty;

    if(OTPRemainAmt <= 0){
        $('#resend_otp_btn').addClass('disabled');
        $('#otp-btn-row').hide(); // 重送隱藏
    }
    else{
        $('#resend_otp_btn').removeClass('disabled');
    }
    
    if (GetTimeRemaining(NextOTPEndTime) > 0) {
        CountDownOTPResendTime(NextOTPEndTime);
        $('#resend_otp_btn').addClass('disabled');
    }
        
    if (OTPRemainAmt > 0 || GetTimeRemaining(OTPExpireTime) > 0) {
        CountDownOTPExpireTime(OTPExpireTime);
    }else{
        $('#otp-code-row').hide(); // hide input
        $('#ranout-msg').html('今日手機驗證碼已達發送上限，請隔日重新操作');
        $('#tp-msg').hide();
        $('#otp_verify_btn').parent().parent().hide(); // hide verify btn
    }

    $('#resend_valid_times').html(OTPRemainAmt);
    $('#dev_otpExpire').html(otp_expire);

    openPopDiv('op_otp_win');
}
var NextOTPEndTime; // OTP可重新傳送時間
var OTPExpireTime;  // OTP期限
var OTPRemainAmt ;  // OTP剩餘次數
var OTPTimer;
var ExpireTimer;
/** OTP倒數*/
var CountDownOTPResendTime = function (endtime) {
    if (OTPTimer) {
        clearInterval(OTPTimer);
    }
    OTPTimer = setInterval(function () {
        /** 剩餘秒數 */
        var rtime = GetTimeRemaining(endtime);
        if (rtime <= 0) {
            clearInterval(OTPTimer);
            $('#resend_otp_btn').removeClass('disabled');
            $('#next_send_timer').html('');
        }
        else{
            $('#next_send_timer').html(rtime);
            $('#resend_otp_btn').addClass('disabled');
        }
            
    }, 1000);
};

/** OTP 期限倒數 */
var CountDownOTPExpireTime = function (endtime) {
    if (ExpireTimer) {
        clearInterval(ExpireTimer);
    }
    ExpireTimer = setInterval(function () {
        /** 剩餘秒數 */
        var rtime = GetTimeRemaining(endtime);
        if (rtime <= 0) {
            clearInterval(ExpireTimer);
            $('#expire_remain_timer').html('00分00秒');
        }
        else{
            var sec = Math.floor((rtime) % 60); 
            var min = Math.floor((rtime/60)%60); 
            var hr = Math.floor((rtime/(60*60)) % 24 ); 
            var day = Math.floor(rtime/(60*60*24));

            if (sec < 10) sec = '0'+(sec.toString());
            if (min < 10) min = '0'+(min.toString());
            if (hr < 10) hr = '0'+(hr.toString());

            $('#expire_remain_timer').html(
                (day > 0 ? day + ' 天' : '') + 
                (hr != '00' ? (hr + ':') : '') +
                min + '分'+ sec + '秒');
        }
            
    }, 1000);
};

/** 記算剩餘秒數 */
var GetTimeRemaining = function(endtime) { 
    return (Date.parse(endtime) - Date.parse(new Date())) / 1000; 
}
</script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>
<script>
  googletag.cmd.push(function() {
    googletag.defineSlot('/17812066/books_member_D_430x390_bot', [480, 320], 'div-gpt-ad-1515639533351-0').addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.pubads().collapseEmptyDivs(true,true);
    googletag.enableServices();
  });
</script>
</head>
<body class="color_public">
<!--Header-->
<script type="text/javascript">
$(function(){
    $(".search_set").hover(function(){
        $(".search_popup").show();
    },function(){
        $(".search_popup").hide();
    });
    $(".search_popup a").click(function(){
        $("#cat").val($(this).attr('cat'));
        $("#search_name").text($(this).text());
        $(".search_popup").hide();
    });
    $("#search" ).submit(function(e){
        if ($('#key').val() === ''){
            alert('請輸入關鍵字');
            e.preventDefault();
        }
    });
});
</script>
<div class="container_24 type04_header_simplify  clearfix" id="header_id" data-attr="simple">
    <div class="grid_24 clearfix">
        <div class="mod header_box clearfix" style="background-image:url(https://db.books.com.tw/G/header/2008/new_header/images/books_logo_a.gif)">
            <div class="books_logo"><a href="https://www.books.com.tw" title="回博客來首頁"><span>回博客來首頁</span></a></div>
            <div class="search clearfix">
                <h2 class="hide">網站搜尋</h2>

                <form action="/member/search" id="search" name="search" method="GET" target="_blank">
                    <input type="text" class="search_key" name="key" id="key" placeholder="請輸入關鍵字">
                    <div class="search_set">
                        <div class="top_search_tip">
                            <a href="javascript:;"><span id="search_name">全館</span><span class="icon" title="展開"</span></a>
                            <input type="hidden" name="cat" id="cat" value ="all">
                        </div>
                        <ul class="search_popup" style="display:none;">
                            <li><a href="javascript:;" cat="all" id="default_search_key">全館</a></li>
                            <li><a href="javascript:;" cat="BKA">圖書</a></li>
                            <li><a href="javascript:;" cat="AVA">影音</a></li>
                            <li><a href="javascript:;" cat="DPA">百貨</a></li>
                            <li><a href="javascript:;" cat="MGA">雜誌</a></li>
                            <li><a href="javascript:;" cat="TKA">售票</a></li>
                        </ul>
                    </div>
                    <button type="submit" title="搜尋"><span class="icon">搜尋</span></button>
                </form>
            </div>
        </div>
    </div>
</div><!--End Header-->
<!--start pop win-->
<div class="newmember_pop newmember message_info clearfix" id="wdialog" style="display: none;">
    <div id="wdialog_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>
    <div class="bd_a">
        <h2 class="title_09" title="提示訊息">提示訊息</h2>
        <!--提示訊息-->
        <div class="set_cont">
            <ul>
                <li>您輸入的帳號或密碼錯誤，請<a href="javascript:;" id="retype">重新輸入</a></li>
                <li>忘了會員帳號與密碼，請<a href="/member/forgot">查詢帳號與密碼</a></li>
                <li>還不是博客來會員，請<a href="/member/join_step1?url=https%3A%2F%2Fwww.books.com.tw%2F" target="_blank">加入會員</a></li>
            </ul>
        </div><!--End 提示訊息-->
    </div>
</div><!--end pop win-->
<!--start pop win-->
<div class="newmember_pop newmember fb_policy clearfix" id="fbterm" style="display: none;">
    <div id="fbterm_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>
    <div class="bd_a">
        <h2 class="title_06" title="會員登入-博客來連結FB帳號，使用說明">博客來連結FB帳號，使用說明</h2>
        <div class="member_m01 clearfix" id="fbterm_text"></div>
        <div class="ft01 btnwrap">
            <span><a href="javascript:;" id="fbterm_agreen" class="button02">同意</a></span>
            <span><a href="javascript:;" id="fbterm_disagreen" class="button03">不同意</a></span>
        </div>
    </div>
</div><!--end pop win-->
<!--start pop win-->
<div class="newmember_pop newmember fb_link clearfix" id="link"  style="display: none;">
    <div id="link_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>
    <div class="bd_a">
        <h2 class="title_07" title="會員登入-連結您的博客來帳號">連結您的博客來帳號</h2>
        <div class="member_m01 clearfix">
            <p>請填入您的博客來會員帳號或e-mail，以及密碼。<br>
            您只需設定一次，日後即可用 facebook 快速登入博客來。</p>
        </div>
        <div class="set_cont">
            <h3 class="pic">fb連結您的博客來帳號</h3>
            <p><input type="text" id="link_id" required="required" placeholder="博客來 帳號ID或email" class="width01 input01" autocorrect="off" autocapitalize="none"></p>
            <p><input type="password" id="link_pswd" required="required" placeholder="博客來 密碼 Password" class="width01 input01" maxlength="12" size="12"></p>
            <p class="point msg" id="link_warn" style="display:none;"></p>
        </div>
        <div class="mod ft01 btnwrap clearfix">
            <span><a href="javascript:;" id="link_agreen" class="button02">同意</a></span>
            <span><a href="javascript:;" id="link_disagreen" class="button03">不同意</a></span>
        </div>
        <ul class="mod member_m03 clearfix">
            <li class="li_left"><a href="/member/forgot" target="_blank">忘記帳號密碼</a></li>
            <li class="li_right">還不是會員? <a href="/member/join_step1?url=https%3A%2F%2Fwww.books.com.tw%2F" target="_blank">加入會員</a></li>
        </ul>
    </div>
</div><!--end pop win-->
<!--start pop win-->
<div class="newmember_pop newmember message_info clearfix" id="pswd_safety"  style="display: none;">
      <div id="pswd_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>
      <div class="bd_a">
	<h2 class="title_09" title="提示訊息">提示訊息</h2>
        <!--提示訊息-->
        <div class="set_cont">
          <ul id="pswd_safety_text">
          </ul>
        </div><!--End 提示訊息-->
        <div class="mod ft01 btnwrap clearfix">
	  <span><a href="#" class="button02" id="update_password1">修改密碼</a></span>
          <span><a href="#" class="button02" id="update_password2">修改密碼</a></span>
          <span><a href="#" class="button03" id="keep_password">沿用舊密碼</a></span>
	</div>
    </div>
  </div><!--end pop win-->

<!--Line 隱私聲明 pop win-->
<div class="newmember_pop newmember line_policy clearfix" id="lineterm" style="display: none;">
    <div id="lineterm_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>
    <div class="bd_a">
        <h2 class="page-title pattern">
          <span><b>博客來連結LINE帳號，使用說明</b></span>
        </h2>
        <div class="member_m01 clearfix" id="lineterm_text"></div>
        <div class="ft01 btnwrap">
            <span><a href="javascript:;" id="lineterm_agreen" class="button02">同意</a></span>
            <span><a href="javascript:;" id="lineterm_disagreen" class="button03">不同意</a></span>
        </div>
    </div>
</div><!--Line 隱私聲明 end pop win-->

<!--Line綁定 pop win-->
<div class="newmember_pop newmember line_link clearfix" id="line_link"  style="display: none;">
    <div id="line_link_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>
    <div class="bd_a">
        <h2 class="page-title pattern">
          <span><b>連結您的LINE帳號</b></span>
        </h2>
        <!--連結您的博客來帳號-->
        <div class="member_m01 clearfix">
          <p>請填入您的博客來會員帳號或e-mail，以及密碼。<br>您只需設定一次，日後即可用 LINE 快速登入博客來。</p>
        </div>
        <div class="set_cont">
            <h3 class="pic">LINE連結您的博客來帳號</h3>
            <p><input type="text" id="line_link_id" required="required" placeholder="博客來 帳號ID或email" class="width01 input01"  autocorrect="off" autocapitalize="none"></p>
            <p><input type="password" id="line_link_pswd" required="required" placeholder="博客來 密碼 Password" class="width01 input01" maxlength="12" size="12"></p>
            <p class="point msg" id="line_link_warn" style="display:none;"></p>
        </div>
        <div class="mod ft01 btnwrap clearfix">
            <span><a href="javascript:;" id="line_link_agreen" class="button02">同意</a></span>
            <span><a href="javascript:;" id="line_link_disagreen" class="button03">不同意</a></span>
        </div>
        <ul class="mod member_m03 clearfix">
            <li class="li_left"><a href="/member/forgot" target="_blank">忘記帳號密碼</a></li>
            <li class="li_right">還不是會員? <a href="/member/join_step1?url=https%3A%2F%2Fwww.books.com.tw%2F" target="_blank">加入會員</a></li>
        </ul>
    </div>
</div><!--Line綁定 end pop win-->

<!--OPENPOINT 隱私聲明 pop win-->
<div id="opterm" class="pop-win newmember op-policy clearfix" style="display:none;">
  <div class="pop-ctn">        
    <div class="wrap">
      <h2 class="page-title pattern">
        <span><b>使用者條款</b></span>
        <a href="javascript:;" id="opterm_close" class="btn-close"><i class="icon-fail"></i></a>
      </h2>
      <div class="scroll-wrap">
        <div id="opterm_text" class="mod-service-policy"></div>
      </div>
      <div class="ft01 btnwrap">
        <span><a href="#" id="opterm_agreen" class="button02">同意</a></span>
        <span><a href="#" id="opterm_disagreen" class="button03">不同意</a></span>                 
      </div>
    </div>
  </div>            
</div><!--OPENPOINT 隱私聲明 end pop win-->

<!-- OPEN POINT OTP 驗證碼 POPUP  -->
<div id="op_otp_win" class="pop-win newmember pop_otp clearfix" style="display:none;">
    <div class="pop-ctn">
        <div class="wrap">
            <h2 class="page-title pattern">
              <span><b>輸入OTP驗證碼</b></span>
              <a id="opOtp_close" href="javascript:;" class="btn-close"><i class="icon-fail"></i></a>
            </h2>
            <div class="scroll-wrap">
                <p id="tp-msg" class="font-13">驗證碼已傳至您的<font color="#d80000">OPEN POINT會員註冊時的手機號碼</font>，請於有效期限內輸入OTP驗證碼</p>
                <div class="set_cont">
                  <ul class="form">
                    <li>行動電話 <span class="phone-number"></span></li>
                    <li id="otp-code-row">
                      <!-- <label class="title">博客來已發送OTP驗證碼至此號碼，請於下方輸入OTP驗證碼</label> -->
                      <p><input type="text" name="otp_code" id="otp_code" required="required" placeholder="OTP驗證碼" maxlength="6" size="6" autocomplete="off"></p>
                      <p class="err"></p>
                      <p class="verify">有效期限 <span id="expire_remain_timer">00分00秒</span></p>
                      <p id="bt-msg" class="msg">如果1分鐘後仍未收到OTP驗證碼或驗證碼已失效，請點選「重新發送驗證碼」，今日剩餘重發次數&nbsp;<font id="resend_valid_times" color="#d80000"></font>&nbsp;次</p>
                    </li>
                    <li>
                        <p id="ranout-msg" class="msg" style="font-size: 15px"></p>
                    </li>
                    <li id="otp-btn-row">
                       <a href="javascript:;" id="resend_otp_btn" class="button03 disabled" role="button">重新發送驗證碼 <span id="next_send_timer"></span></a>
                    </li>
                    <li id="dev_otp" style="color: green; text-align: center; display: none;">
                        ↓↓↓↓測試機才看得到↓↓↓↓<br/>
                        最新OTP驗證碼：<span id="dev_otpCode"></span><br/>
                        有效期限至 <span id="dev_otpExpire"></span>
                    </li>
                  </ul>
                </div>
                <div class="mod ft01 btnwrap">
                  <span><a href="javascript:;" id="otp_verify_btn" class="button02" role="button">確認</a></span>
                </div>
                <h3 class="panel-title clearfix">
                  <span><!-- <b>備註 / 說明</b> --><b>收不到手機驗證碼？</b></span>
                </h3>
                <ul class="list-group-icon font-13 clearfix">
                  <li>檢查手機收訊是否良好</li>
                  <li>是否曾向電信業者申請拒收「企業簡訊」</li>
                  <li>檢查手機簡訊容量是否不足</li>
                  <li>每個手機門號每日OTP驗證上限10次，超過次數請於隔日重新操作，敬請見諒</li>
                </ul>
            </div><!-- scroll-wrap End -->
        </div>
    </div> <!-- pop_ctn End-->
</div><!--end pop win-->

<!-- OPEN POINT 綁定 POPUP -->
<div id="op_link" class="newmember_pop newmember op_link clearfix" style="display: none">      
    <div id="op_link_close" class="close_pop" title="關閉視窗"><span>關閉視窗</span></div>   
    <div class="bd_a">
        <h2 class="page-title pattern">
          <span><b>連結您的博客來帳號</b></span>
        </h2>
        <!--連結您的博客來帳號-->
        <div class="member_m01 clearfix">
            <p>請填入您的博客來會員帳號或 e-mail 以及密碼。<br>
            您只需設定一次，日後即可用 OPEN POINT 快速登入博客來。
            </p>
        </div>
        <div class="set_cont">
          <h3 class="pic">op連結您的博客來帳號</h3>
          <p><input type="text" id="op_link_id" value="" class="width01 input01" placeholder="博客來 帳號ID或email" required="required"></p>
          <p><input type="password" id="op_link_pswd" value="" class="width01 input01" placeholder="博客來 密碼 Password" required="required"></p>
          <p class="point msg" id="op_link_warn" style=""></p>
        </div>
        <!--End 連結您的博客來帳號-->                              
        <div class="mod ft01 btnwrap clearfix">
            <span><a href="javascript:;" id="op_link_agreen" class="button02">同意</a></span>
            <span><a href="javascript:;" id="op_link_disagreen" class="button03">不同意</a></span>                             
        </div>
        <ul class="mod member_m03 clearfix">
          <li class="li_left"><a href="/member/forgot">忘記帳號密碼</a></li>
          <li class="li_right">還不是會員? <a href="/member/join_step1?url=https%3A%2F%2Fwww.books.com.tw%2F">加入會員</a></li>
        </ul>
    </div>
</div>

<!--main_wrap-->
<div class="container_24 main_wrap clearfix">
    <!--main_column( 20grid:790px )-->
    <div class="grid_20 push_2 newmember">
        <div class="mod join_wrap clearfix">
            <div class="box_1 grid_13 alpha">
                <!--m04-->
                <div class="mod member_m04 flearfix">
                    <h3 class="hide">廣告輪播</h3>
                    <!--<input type="hidden" id="bannerStart" value="" />-->
                    <!--Banner430x390-->
<!--                    <ul class="banner" style="display:none;">
                        <li class="banli" id="banner_"><a  target="_blank"><img class="ban" src=""></a></li>
                    </ul>
                    <div class="cycle_btn" style="display:none;">
                        <ul class="btn">
                            <li class="banner_btn" id=""><a title="" href="javascript:;"><span></span></a></li>
                        </ul>
                    </div>-->
                    <!-- /17812066/books_member_D_430x390_bot -->
                    <div id='div-gpt-ad-1515639533351-0' style='height:320px; width:480px;'>
                    <script>
                    googletag.cmd.push(function() {
                            googletag.display('div-gpt-ad-1515639533351-0'); 
                    });
                    </script>
                    </div>
                </div><!--End m04-->
            </div>
            <div class="box_2 grid_7 omega">
                <div class="content_wrap">
                    <div class="bd_b">
                        <h1 class="title_05" title="會員登入">會員登入</h1>
                        <div class="mod clearfix">
                            <table class="table_c">
                                <col width="50%">
                                <col width="50%">
                                <tbody>
                                    <tr><td colspan="2">
                                            <input type="text" name="login_id" id="login_id" value="wtb0806" class="width01 input01" required="required" placeholder="帳號ID或email" maxlength="50" size="50" tabindex="1" autocorrect="off" autocapitalize="none">
                                            <p class="point msg" id="id_warn" style="display:none;"></p>
                                        </td></tr>
                                    <tr><td colspan="2">
                                            <input type="password" name="login_pswd" id="login_pswd" class="width01 input01" required="required" placeholder="密碼 Password" maxlength="12" size="12" tabindex="2">
                                            <p class="point msg" id="pswd_warn" style="display:none;"></p>
                                            <p class="point msg" id="caps_warn" style="display:none;">大寫鎖定 (Caps Lock) 已啟用</p>
                                            <input type="hidden" name="url" id="url" value="https://www.books.com.tw/">
                                            <input type="hidden" name="content" id="content" value="">
                                        </td></tr>
                                    <tr><td colspan="2">
                                            <input type="text" name="captcha" id="captcha" class="width01 input01" required="required" placeholder="請輸入驗證碼（不分大小寫）" maxlength="4" size="6" autocomplete="off" tabindex="3">
                                            <p class="point msg" id="captcha_warn" style="display:none;"></p>
                                    </td></tr>
                                    <tr>
                                        <td>
                                            <div id="captcha_img"><img src="/member/captcha_login?8d15dc7b031159786866c0d4650286fd" width="160" height="75"></div>
                                        </td>
                                        <td style="text-align:center;"><p><a href="javascript:;" id="regen">更新驗證碼</a></p></td>
                                    </tr>
                                    <tr><td colspan="2"><button id="books_login" class="button04" tabindex="4">登入</button></td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mod clearfix">
                            <ul class="member_m03">
                                <li class="li_left"><a href="/member/forgot">忘記帳號密碼</a></li>
                                <li class="li_right">還不是會員? <a href="/member/join_step1?url=https%3A%2F%2Fwww.books.com.tw%2F" target="_blank">加入會員</a></li>
                            </ul>
                        </div>
                        <div class="mod sns-btn-group h">
                            <h3>更多登入方式</h3>
                            <ul>
                                <li>
                                    <a href="javascript:;" id="facebook_login" class="sns-btn btn-fb" title="Facebook登入">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用&nbsp;Facebook&nbsp;登入</a>
                                    <input type="hidden" id="fbUrl" value="https://www.facebook.com/v3.2/dialog/oauth?client_id=210743125726405&scope=email,public_profile&redirect_uri=https%3A%2F%2Fcart.books.com.tw%2Fmember%2Ffb_login_do&display=popup" />
                                </li>
                                <li>
                                    <a href="javascript:;" id="line_login" class="sns-btn btn-line" title="Line登入">&nbsp;&nbsp;&nbsp;&nbsp;使用&nbsp;LINE&nbsp;登入</a>
                                </li>
                                <li>
                                                                    <a href="javascript:;" id="op_login" class="sns-btn btn-op">&nbsp;&nbsp;&nbsp;&nbsp;使用&nbsp;OPEN&nbsp;POINT&nbsp;登入</a>
                                                                </li>    
                                
                            </ul>
                        </div>
                    </div>
                </div>
<!--                <div>
                    <div id="twcaseal" class="small3" style="height:100px; margin:10px auto 0; width: 113px;"><img src='/image/twcaseal_small3.jpg'/></div>
                    <script type="text/javascript" src="//ssllogo.twca.com.tw/twcaseal2_v3.js" charset="utf-8"></script>
                </div>-->
            </div>
        </div>
    </div><!--end main_column-->
    <!--right_column( 2grid:70px )-->
    <div class="grid_2 push_2">&nbsp;</div><!--end right_column-->
    <!--left_column( 2grid:70px )-->
    <div class="grid_2 pull_22">&nbsp;</div><!--end left_column-->

</div><!--End main_wrap-->
<!--footer-->
<div class="container_24 type04_footer_simplify clearfix">
    <div class="grid_24 wrap clearfix">
        <div class="bd">
            <h4 class="books_logo"><a></a></h4>
            <ul class="service_message">
                <li><p><span>客戶服務專線：02-26535588</span><span>傳真：02-27885008</span><span>服務時間：週一~五 8:00~19:00，週六~日、例假日 9:00~18:00，365天全年無休</span></p></li>
                <li><p><span>博客來數位科技股份有限公司</span><span>地址：115 台北市南港區八德路四段768巷1弄18號B1之1</span></p></li>
                <li><p>Copyright &copy; since 1995 books.com.tw All Rights Reserved.</p></li>
            </ul>
        </div>
    </div>
</div><!--End footer--></body>
</html>
